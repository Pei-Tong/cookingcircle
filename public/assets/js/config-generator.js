class ConfigGenerator{constructor(){this.defaultActions=[{text:"Edit",class:"text-primary hover:text-sky-700 mr-3",action:"edit"},{text:"Delete",class:"text-red-500 hover:text-red-700",action:"delete",confirmMessage:"Are you sure?"}],this.fieldRenderers={timestamp:(e,t)=>e[t]?new Date(e[t]).toLocaleString():"",date:(e,t)=>e[t]?new Date(e[t]).toLocaleDateString():"",boolean:(e,t)=>e[t]?"Yes":"No",url:(e,t)=>e[t]?t.includes("image")||t.includes("avatar")||t.includes("photo")?`<img src="${e[t]}" alt="" class="h-10 w-10 rounded object-cover">`:`<a href="${e[t]}" target="_blank" class="text-primary hover:underline">${this.truncateText(e[t])}</a>`:"",array:(e,t)=>Array.isArray(e[t])?e[t].join(", "):""},this.specialColumns={image_url:e=>e.image_url?`<img src="${e.image_url}" alt="" class="h-10 w-10 rounded-md object-cover">`:"",avatar_url:e=>e.avatar_url?`<img src="${e.avatar_url}" alt="" class="h-10 w-10 rounded-full object-cover">`:"",created_at:e=>e.created_at?new Date(e.created_at).toLocaleString():"",updated_at:e=>e.updated_at?new Date(e.updated_at).toLocaleString():""}}async generateConfig(t,e={}){var r=await schemaService.getTableSchema(t);if(!r||!r.columns||0===Object.keys(r.columns).length)return console.error(`Could not generate configuration for ${t}: No schema information available`),null;var n=this.formatTableName(t),a=this.generateColumns(r),r=r.primaryKey||"id";const s={tableName:t,idField:r,title:n,columns:a,actions:[...this.defaultActions],orderBy:{column:"created_at",ascending:!1}};return s.actions=s.actions.map(e=>("view"===e.action&&(e.handler=`show${this.singularize(t)}Detail`),e)),this.mergeConfigs(s,e)}generateColumns(e){const t=[],r=Object.keys(e.columns),n=["updated_at","deleted_at"],a=r.filter(e=>!n.includes(e));var s=this.findNameColumn(a);if(s){t.push(this.generateNameColumn(s,e));const i=[s,"image_url","avatar_url","photo_url","description"];for(const o of a.filter(e=>!i.includes(e)))t.push(this.generateColumnConfig(o,e.columns[o]))}else for(const l of a)t.push(this.generateColumnConfig(l,e.columns[l]));return t}findNameColumn(e){for(const t of["name","title","full_name","username","email","label"])if(e.includes(t))return t;return null}generateNameColumn(r,t){const n=["image_url","avatar_url","photo_url"].find(e=>t.columns[e]),a=["description","summary","subtitle","tagline"].find(e=>t.columns[e]);return{key:r,header:this.formatColumnName(r),render:e=>{let t='<div class="flex items-center">';return n&&e[n]&&(t+=`
            <div class="flex-shrink-0 h-10 w-10 mr-3">
              <img class="h-10 w-10 rounded-md object-cover" src="${e[n]}" alt="">
            </div>
          `),t=(t+="<div>")+(""+(e[r]||"Untitled")),a&&e[a]&&(e="string"==typeof e[a]?e[a]:String(e[a]),e=this.truncateText(e,60),t+=`<p class="text-xs text-gray-500">${e}</p>`),t+="</div></div>"}}}generateColumnConfig(t,r){if(["image_url","avatar_url","photo_url"].includes(t))return null;const e={key:t,header:this.formatColumnName(t),fallback:t.includes("count")?0:""};return"recipe_id"===t||t.endsWith("_recipe_id")?e.render=async e=>{e=e[t];return foreignKeyResolver.resolve("recipe_id",e)}:this.specialColumns[t]?e.render=e=>this.specialColumns[t](e):r&&this.fieldRenderers[r.type]?e.render=e=>this.fieldRenderers[r.type](e,t):t.endsWith("_count")?e.render=e=>e[t]||0:(t.endsWith("_time")||t.includes("duration"))&&(e.render=e=>e[t]?e[t]+" mins":"N/A"),e}formatTableName(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}formatColumnName(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}singularize(e){const t=this.formatTableName(e);return t.endsWith("ies")?t.slice(0,-3)+"y":t.endsWith("s")?t.slice(0,-1):t}truncateText(e,t=30){return e?e.length>t?e.substring(0,t)+"...":e:""}mergeConfigs(e,t){const r={...e};if(t.columns){const n={},a=(t.columns.forEach(e=>{n[e.key]=e}),r.columns=r.columns.map(e=>n[e.key]?{...e,...n[e.key]}:e),r.columns.map(e=>e.key));e=t.columns.filter(e=>!a.includes(e.key));r.columns=[...r.columns,...e]}return Object.keys(t).forEach(e=>{"columns"!==e&&(r[e]=t[e])}),r}}const configGenerator=new ConfigGenerator;